: Como alterar o schema de uma tabela ?
ALTER TABLE bigdata_empresas.pj_cnaes_list SET SCHEMA "bigdata_final";
* altera o schema da tabela `pj_cnaes_list` de `bigdata_empresas` para `bigdata_final`.

: Como ver as tabelas do banco.schema ?
$ docker exec -t postgres-db psql -U postgres -d rvx-bigdata -c '\dt bigdata_final.*'

: Como fazer transfer√™ncias de tabelas de um schema para outro schema ?
$ docker exec -t postgres-db pg_dump -U postgres -d rvx-bigdata -n bigdata_empresas -Fc -f /var/lib/postgresql/data/dump_bigdata_empresas.backup
para restaurar
$ docker exec -t postgres-db pg_restore -U postgres -d rvx-bigdata -n bigdata_final /var/lib/postgresql/data/dump_bigdata_empresas.backup

: Como fazer backup de uma tabela ?
$ pg_dump -h 127.0.0.1 -p 5454 -U postgres -d rvx-bigdata --table=bigdata_final.pf_telefones -Fc -f pf_telefones.pg_dump
para restaura
$ pg_restore -h 127.0.0.1 -p 5432 -U postgres -d rvx-bigdata pf_telefones.dump
* A op√ß√£o "-Fc" usa o formato "Custom Format" (compacta√ß√£o bin√°ria), usa ZLIB para compacta√ß√£o intermedi√°ria.
* A op√ß√£o "-Fp" usa o formato sql puro.
* √© poss√≠vel acrescentar mais um n√≠vel de compacta√ß√£o usando o GZIP

: Como exportar a tabela "pj_empresas_socios" ?
$ docker exec -t postgres-db pg_dump -U postgres -d rvx-bigdata -t bigdata_empresas.pj_empresas_socios | gzip > pj_empresas_socios.sql.gz

: Como importar a tabela "pj_qualificacoes_socios" ?
$ gunzip -c pj_qualificacoes_socios.sql.gz | docker exec -i postgres-db-hd2-type2 psql -U postgres -d rvx-bigdata
* certifique-se que de que a sequence existe.

: Como importar a tabela "pj_empresas_socios" ?
$ gunzip -c pj_empresas_socios.sql.gz | docker exec -i postgres-db-hd2-type2 psql -U postgres -d rvx-bigdata
* certifique-se que de que a sequence existe.

: Como verificar o status da cria√ß√£o de √≠ndice de uma tabela ?
> SELECT pid, datname, command, phase, tuples_total, tuples_done FROM pg_stat_progress_create_index;

: Como fazer um backup de pessoas ?
$ docker exec -it postgres-db psql -U postgres -d rvx-bigdata -c "COPY (SELECT id, cpf, nome, cpf_basico FROM bigdata_final.pf_pessoas) TO STDOUT DELIMITER ';' CSV HEADER" | gzip > pf_pessoas.csv.gz
$ docker exec -it postgres-db psql -U postgres -d rvx-bigdata -h 5.189.187.92 -p 5454 -c "COPY (SELECT id, cpf, nome, cpf_basico FROM bigdata_final.pf_pessoas) TO STDOUT DELIMITER ';' CSV HEADER" | gzip > pf_pessoas.csv.gz
$ docker exec -it postgres-db psql -U postgres -d rvx-bigdata \
  -c "
INSERT INTO bigdata_final.pf_pessoas (id, cpf, nome, cpf_basico)
SELECT id, cpf, nome, cpf_basico
FROM bigdata_final.dblink(
  'dbname=rvx-bigdata port=5454 host=5.189.187.92 user=postgres password=455ttte',
  'SELECT id, cpf, nome, cpf_basico FROM bigdata_final.pf_pessoas'
) AS t(id integer, cpf text, nome text, cpf_basico text);
"

: Qual √© a rela√ß√£o de tabelas bigdataFinal com Tempor√°rias
# bigdata_final.pj_cnaes_list
- link : tmp_empresas.cnaes
- fields: id, codigo, name, updated_at, created_at

# bigdata_final.pj_empresas

# bigdata_final.pj_empresas_cnaes

# bigdata_final.pj_empresas_emails
fields: id, cnpj, email, data_origem, origem, updated_at, created_at

# bigdata_final.pj_naturezas_juridicas

# bigdata_final.pj_qualificacoes_socios

: Hist√≥rico de importa√ß√£o
- 1 000 000 /   100 000 em 07 minutos
- 1 000 000 / 1 000 000 em 02 minutos
- 10 000 000 / 10 000 000 em 35 minutos
- 70 000 000 / 10 000 000 em -- minutos

: Como criar a docker do postgreSQL ?
$ docker run --restart=always -d --name postgres-db \
  --cpuset-cpus=0-10 \
  --memory=8g \
  --cpus=4 \
  -e TZ=America/Sao_Paulo \
  -e POSTGRES_PASSWORD=455ttte \
  -e PGDATA=/var/lib/postgresql/data/pgdata \
  -v /media/dados/rvx:/var/lib/postgresql/data \
  -p 5454:5432 \
  postgres:14.2-alpine
$ docker logs -f postgres-db
$ docker restart postgres-db
$ docker exec -it postgres-db cat /var/lib/postgresql/data/pgdata/postgresql.conf | grep -i max_wal_size

: Como dividir um arquivo grande ?
$ sed -n '1,1000p' arquivo_grande.txt > arquivo_mil_linhas.txt
* √© bom para arquivos com v√°rios GIGAS, pois ele n√£o joga tudo na mem√≥ria.

$ head -n 1000 arquivo_grande.txt > arquivo_mil_linhas.txt
* melhor o sed

: Como remover o caracter nulo de um CSV ?
$ sed 's/\x0//g' estabelecimentos9.csv > estabelecimentos9.tmp && mv estabelecimentos9.tmp estabelecimentos9.csv

: Quais os √≠cones bonitinhos ?
‚ùå ‚úÖ ‚ùé üõë üìÅ üìä ‚ö†Ô∏è üì£ üìã üîó üìÑ üì• ‚åõ ‚è∞ ‚è± üöÄ üü¢ ‚ö° üîÑ üí° üòé üòÑ üëâ üîé üì∂ üóÑ üèõ üóÉ üèπ üîî ‚Üë üèÅ üóúÔ∏è ‚¨áÔ∏è üåê üì∏ üïµÔ∏è‚Äç‚ôÇÔ∏è üëç üêò üçÉ üì¶

: Como pegar as √∫ltimas linhas de um arquivo ?
$ tail -n 10 arquivo

: Como pego o n√∫mero de linha de um arquivo ?
$ wc -l arquivo

: Como procurar um testo no arquivo ?
$ egrep "testo a procurar" arquivo

: Qual √© o caracter que est√° empatadando a importa√ß√£o da CSV estabelementos ?
^@
Erro ao importar estabelecimentos0.csv_part_ad: ERROR:  unterminated CSV quoted field
CONTEXTO:  COPY estabelecimentos, line 5000000: ""95261103";"0001";"11";"1";"PEG E PAG";"08";"20081231";"71";"";"";"19930722";"4789007";"";"AVENIDA";..."
Erro ao importar estabelecimentos9.csv: ERROR:  unterminated CSV quoted field
CONTEXTO:  COPY estabelecimentos, line 4753437: ""13269396";"0001";"19";"1";"";"03";"20211009";"74";"";"845";"20110217";"6462000";"";"";"CALLE CERRIT..."
o caracter ^@ est√° cortando o campo e provoca o erro, tem que editar antes de importar.

: Quantos registros pelo CSV para empresas
23.537.416 - storage/cache/cnpj_csv/empresas0.csv
 4.494.860 - storage/cache/cnpj_csv/empresas1.csv
 4.494.860 - storage/cache/cnpj_csv/empresas2.csv
 4.494.860 - storage/cache/cnpj_csv/empresas3.csv
 4.494.860 - storage/cache/cnpj_csv/empresas4.csv
 4.494.860 - storage/cache/cnpj_csv/empresas5.csv
 4.494.860 - storage/cache/cnpj_csv/empresas6.csv
 4.494.860 - storage/cache/cnpj_csv/empresas7.csv
 4.494.860 - storage/cache/cnpj_csv/empresas8.csv
 4.494.860 - storage/cache/cnpj_csv/empresas9.csv

: Quantos registros tem as tabelas tempor√°rias de "2025-08-10" ?
local:
249.947.040 - pf_pessoas
171.975.929 - empresas_cnaes
179.163.131 - pj_empresas_cnaes
 67.640.763 - pj_empresas_enderecos
 26.397.253 - pj_empresas_socios (1.382.627 is null)
 67.125.899 - estabelecimentos
 67.640.763 - pj_empresas
 44.584.423 - simples
 26.197.302 - socios
     11.144 - munic√≠pios
      2.718 - cnaes
        510 - paies
        136 - qualificacoes

produ√ß√£o:
45.003.549 - pj_empresas
22.945.610 - pj_empresas_socios
171.975.929 - pj_empresas_cnaes
- pj_empresas_emails
- pj_empresas_enderecos
- pj_empresas_socios
- pj_empresas_telefones
- pj_naturezas_juridicas
- pj_qualificacoes_socios

: Quantos minutos para importar 1 milh√£o de pj_empresas ?
1 000 000  7 minutos

: Como limpar a tabela pg_empresas ?
OUTPUT=$(PGPASSWORD="$DB_PASSWORD" "${PSQL_CMD[@]}" -c "truncate $DB_SCHEMA.pj_empresas" 2>&1)

:
# Tabelas = campos a serem importadas do CSV
TABLES=(
    "pj_cnaes_list: fields{codigo, name}, table_tmp: " 
    "pj_qualificacoes_socios= codigo, descricao" 
    "pj_naturezas_juridicas= codigo, descricao" 
    "pj_empresas_telefones= cnpj,telefone, data_origem, origem"
    "pj_empresas_emails= cnpj, email, data_origem, origem" 
    "pj_empresas_cnaes= cnpj, cnae, tipo, origem, data_origem"
    "pj_empresas_socios= cpf, cnpj, identificador, qualificacao, data_entrada date, pais, cpf_representante, nome_representante, qualificacao_representante, faixa_etaria, participacao, origem, data_origem date"
    "pj_empresas_enderecos= uuid, cnpj, tipo, titulo, logradouro, numero, complemento, bairro, cidade, uf, cep, area_risco, origem, data_origem, latitude, longitude"
    "pj_empresas= cnpj, razao_social, nome_fantasia, situacao, situacao_descricao, situacao_data, situacao_motivo, situacao_motivo_descricao, tipo, tipo_descricao, abertura, cod_natureza, natureza_juridica_descricao, capital, porte, porte_descricao, origem, qualificacao_responsavel, optante_simples, data_opcao_simples, data_exclusao_simples, data_opcao_mei, data_exclusao_mei, cnpj_basico, data_origem"
)

: Operadores de compara√ß√£o num√©rica comuns em Bash
- -eq: igual a (equal)
- -ne: diferente de (not equal)
- -gt: maior que (greater than)
- -lt: menor que (less than)
- -ge: maior ou igual a (greater or equal)
- -le: menor ou igual a (less or equal)